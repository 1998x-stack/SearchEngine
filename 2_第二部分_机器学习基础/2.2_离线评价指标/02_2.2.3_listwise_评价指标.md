# 02_2.2.3_listwise_评价指标

"""
Lecture: 2_第二部分_机器学习基础/2.2_离线评价指标
Content: 02_2.2.3_listwise_评价指标
"""

### Listwise 评价指标的极致详细分析

#### 一、任务综述
Listwise 评价指标是一类用于评估排序模型性能的重要指标。与 Pointwise 和 Pairwise 不同，Listwise 评价指标关注的是整个列表的排序质量。其核心思想是通过评估整个结果列表的排序效果来衡量模型的性能。在搜索引擎和推荐系统中，Listwise 评价方式更符合用户体验，因为用户通常关心的是整个结果列表的质量，而不仅仅是某些单独的对或点。

#### 二、Listwise 评价指标的分类

##### 1. DCG（Discounted Cumulative Gain）
DCG 是 Listwise 评价指标中最常用的一种，用于评估排序结果的质量。DCG 的计算公式为：
$$ \text{DCG@k} = \sum_{i=1}^{k} \frac{2^{y_i} - 1}{\log_2(i + 1)} $$
其中，$ y_i $ 是位置 $ i $ 上文档的相关性分数，$ k $ 是评价的前 $ k $ 个文档。DCG 通过对排名靠前的文档给予更高的权重来反映其重要性。

##### 2. IDCG（Ideal Discounted Cumulative Gain）
IDCG 是在理想情况下的 DCG，即相关性最高的文档都排在最前面的情况下的 DCG。IDCG 的计算公式与 DCG 相同，只是相关性分数 $ y_i $ 是按照降序排列的。

##### 3. NDCG（Normalized Discounted Cumulative Gain）
NDCG 是对 DCG 进行归一化处理，以便不同查询的评价结果具有可比性。NDCG 的计算公式为：
$$ \text{NDCG@k} = \frac{\text{DCG@k}}{\text{IDCG@k}} $$
NDCG 的取值范围为 0 到 1，值越大表示排序效果越好。

#### 三、模型训练与优化

##### 1. 数据预处理
在进行 Listwise 评价之前，需要对数据进行预处理，包括数据清洗、特征选择和特征工程等。例如，在搜索相关性评估中，可以使用 TF-IDF、词嵌入等特征来表示文档和查询词。

##### 2. 模型训练
Listwise 评价指标在模型训练过程中起到重要作用。通过最小化 Listwise 损失函数，可以优化模型参数，提高模型的排序性能。

#### 四、实际应用中的注意事项

##### 1. 特征工程
特征工程是提升模型性能的关键步骤。通过生成高质量的特征，可以显著提高模型的排序能力。例如，在搜索相关性任务中，可以结合词频、逆文档频率（TF-IDF）、词向量等特征。

##### 2. 模型调优
模型调优包括选择合适的超参数、使用正则化技术和集成方法等。可以通过交叉验证选择最优的超参数，使用 L1 或 L2 正则化来防止过拟合，并结合多个模型的结果进行集成学习。

#### 五、Listwise 评价指标的优缺点

##### 1. 优点
- **更符合用户体验**：Listwise 评价指标通过评估整个结果列表的排序质量，更加符合用户在搜索引擎和推荐系统中的实际体验。
- **考虑全局排序关系**：Listwise 评价指标考虑了结果列表中所有文档的排序关系，能够全面反映模型的排序效果。

##### 2. 缺点
- **计算复杂**：相比于 Pointwise 和 Pairwise 评价指标，Listwise 评价指标需要计算整个结果列表的排序质量，计算复杂度更高。
- **数据需求大**：为了保证评估的准确性，Listwise 评价指标需要大量的标注数据，这在某些应用场景中可能难以满足。
