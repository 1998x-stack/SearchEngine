# 00_3.5.1_特征

"""
Lecture: 3_第三部分_什么决定用户体验？/3.5_个性化与点击率预估
Content: 00_3.5.1_特征
"""

### 特征的极致详细分析

#### 一、任务综述
在个性化和点击率预估中，特征起到了至关重要的作用。通过分析用户的查询词、文档特征、用户特征和场景特征，可以有效提升推荐系统和搜索引擎的准确性和用户满意度。

#### 二、特征的基本分类

##### 1. 按来源分类
- **查询词特征**：包括文本特征、查询词的类目、查询词的意图（如时效性、地域性的诉求）。
- **文档特征**：包括文档ID、作者ID、文档类目、命名实体、地理定位、发布时间等。
- **用户特征**：包括用户ID、用户画像（如性别、年龄等）、用户历史行为序列。
- **场景特征**：包括当前时刻、是否是周末或节假日、用户所在地点、设备信息等。
- **统计特征**：包括文档的曝光次数、点击次数、交互次数、点击率、交互率等。

##### 2. 按性质分类
- **数值特征**：如文档的发布时间、点击次数等。
- **离散特征**：如查询词的类目、用户的性别等。

#### 三、特征的详细分析

##### 1. 查询词特征
- **文本特征**：使用BERT模型对查询词进行向量表征，存储在哈希表中，供线上读取。
- **查询词类目和意图**：如时效性诉求和地域性诉求，通过分词器将查询词切分成多个词，并将每个词表征为向量。

##### 2. 文档特征
- **文档ID和作者ID**：通过嵌入层表征为向量，由于数量巨大，对训练和推理要求较高。
- **文档类目和命名实体**：离散特征，经嵌入层表征为向量，反映用户是否对文档感兴趣。
- **地理定位**：反映文档的地理位置，对用户的本地化需求有很大影响。
- **发布时间**：通常对其做分桶处理，转化为离散特征。
- **内容质量分数**：数值特征，对点击率模型有微弱贡献。

##### 3. 用户特征
- **用户ID**：通过嵌入层表征为向量，记录用户的兴趣点。
- **用户画像**：包括性别、年龄、感兴趣的类目和命名实体等，离散特征经嵌入层表征为向量。
- **用户历史行为序列**：包括最近搜索过的查询词、点击过的文档、交互过的文档，被表征为多个向量。

##### 4. 场景特征
- **当前时刻**：反映用户在不同时间段的搜索需求。
- **是否是周末或节假日**：反映用户在不同日期的搜索需求。
- **用户所在地点**：用户对所在地内容更感兴趣，因此需要地点特征。
- **设备信息**：如iOS和安卓用户的点击率有显著差异。

#### 四、特征交叉与建模

##### 1. 特征交叉
特征交叉是提升模型能力的重要方法，通过将不同特征组合在一起，可以捕捉到更多的复杂关系。
- **方法**：可以使用简单的拼接、乘积等方法，也可以使用深度交叉网络（DCN）等高级方法。

##### 2. 用户行为序列建模
系统记录用户的最近行为，并将这些行为表征为向量输入模型。
- **点击行为**：记录用户最近点击的文档ID，将这些ID表征为向量并取平均。
- **搜索行为**：记录用户最近搜索的查询词，用BERT模型离线计算查询词的向量表征。

#### 五、特征的重要性评估
在模型训练过程中，通过特征重要性评估可以确定哪些特征对模型效果贡献最大。
- **方法**：可以使用树模型的特征重要性方法，或通过模型训练的梯度信息评估。
- **应用**：根据特征的重要性，优化特征工程，去除无效特征，增强模型的泛化能力。

#### 六、总结
特征在个性化和点击率预估中扮演关键角色。通过合理的特征选择、交叉和建模，可以显著提升推荐系统和搜索引擎的效果。在实际应用中，持续优化特征工程是保持模型竞争力的重要手段。

---

### 特征分类的极致详细比较表

| 特征类别        | 特征名称               | 详细说明                                                                                     | 特征类型  | 例子                                                                                           |
|---------------|----------------------|------------------------------------------------------------------------------------------|-------|------------------------------------------------------------------------------------------------|
| **查询词特征**    | 文本特征                | 使用BERT模型对查询词进行向量表征，存储在哈希表中，供线上读取。                                                 | 连续型   | "北京的天气", "附近的餐厅"                                                                           |
|               | 查询词类目和意图          | 查询词的类别和用户意图，如时效性诉求和地域性诉求，通过分词器将查询词切分成多个词，并将每个词表征为向量。                          | 离散型   | 查询词："买手机"，类目："电子产品"，意图："购买"                                                                 |
| **文档特征**      | 文档ID和作者ID          | 通过嵌入层表征为向量，由于数量巨大，对训练和推理要求较高。                                                     | 离散型   | 文档ID：12345，作者ID：67890                                                                         |
|               | 文档类目和命名实体        | 离散特征，经嵌入层表征为向量，反映用户是否对文档感兴趣。                                                         | 离散型   | 类目："旅游"，命名实体："故宫"                                                                            |
|               | 地理定位                | 反映文档的地理位置，对用户的本地化需求有很大影响。                                                              | 连续型   | 地理位置："北京"，"上海"                                                                               |
|               | 发布时间                | 通常对其做分桶处理，转化为离散特征。                                                                 | 离散型   | 发布时间："2024-07-24"                                                                             |
|               | 内容质量分数            | 数值特征，对点击率模型有微弱贡献。                                                                        | 连续型   | 质量分数：0.85                                                                                      |
| **用户特征**      | 用户ID                | 通过嵌入层表征为向量，记录用户的兴趣点。                                                                   | 离散型   | 用户ID：54321                                                                                     |
|               | 用户画像                | 包括性别、年龄、感兴趣的类目和命名实体等，离散特征经嵌入层表征为向量。                                             | 离散型   | 性别："男"，年龄："25岁"，感兴趣的类目："科技"，感兴趣的命名实体："苹果公司"                                                   |
|               | 用户历史行为序列          | 包括最近搜索过的查询词、点击过的文档、交互过的文档，被表征为多个向量。                                                | 连续型   | 最近搜索："买手机"，最近点击文档ID：12345，最近交互文档ID：67890                                                   |
| **场景特征**      | 当前时刻                | 反映用户在不同时间段的搜索需求。                                                                      | 连续型   | 当前时间："2024-07-24 15:30"                                                                         |
|               | 是否是周末或节假日        | 反映用户在不同日期的搜索需求。                                                                        | 离散型   | 是否周末："是"                                                                                      |
|               | 用户所在地点            | 用户对所在地内容更感兴趣，因此需要地点特征。                                                             | 连续型   | 用户地点："北京市海淀区"                                                                                  |
|               | 设备信息                | 如iOS和安卓用户的点击率有显著差异。                                                                     | 离散型   | 设备："iPhone"，"安卓"                                                                               |
| **统计特征**      | 曝光次数                | 文档的曝光次数。                                                                              | 连续型   | 曝光次数：10000                                                                                     |
|               | 点击次数                | 文档的点击次数。                                                                              | 连续型   | 点击次数：5000                                                                                      |
|               | 交互次数                | 文档的交互次数，如点赞、评论、收藏等。                                                                | 连续型   | 交互次数：2000                                                                                      |
|               | 点击率                 | 文档的点击率，点击次数与曝光次数之比。                                                                 | 连续型   | 点击率：0.5                                                                                       |
|               | 交互率                 | 文档的交互率，交互次数与曝光次数之比。                                                                 | 连续型   | 交互率：0.2                                                                                       |

### 特征分类详细分析

#### 查询词特征
1. **文本特征**：
   - **定义**：使用BERT模型对查询词进行向量表征，存储在哈希表中，供线上读取。
   - **类型**：连续型
   - **例子**：查询词："北京的天气", "附近的餐厅"

2. **查询词类目和意图**：
   - **定义**：查询词的类别和用户意图，如时效性诉求和地域性诉求，通过分词器将查询词切分成多个词，并将每个词表征为向量。
   - **类型**：离散型
   - **例子**：查询词："买手机"，类目："电子产品"，意图："购买"

#### 文档特征
1. **文档ID和作者ID**：
   - **定义**：通过嵌入层表征为向量，由于数量巨大，对训练和推理要求较高。
   - **类型**：离散型
   - **例子**：文档ID：12345，作者ID：67890

2. **文档类目和命名实体**：
   - **定义**：离散特征，经嵌入层表征为向量，反映用户是否对文档感兴趣。
   - **类型**：离散型
   - **例子**：类目："旅游"，命名实体："故宫"

3. **地理定位**：
   - **定义**：反映文档的地理位置，对用户的本地化需求有很大影响。
   - **类型**：连续型
   - **例子**：地理位置："北京"，"上海"

4. **发布时间**：
   - **定义**：通常对其做分桶处理，转化为离散特征。
   - **类型**：离散型
   - **例子**：发布时间："2024-07-24"

5. **内容质量分数**：
   - **定义**：数值特征，对点击率模型有微弱贡献。
   - **类型**：连续型
   - **例子**：质量分数：0.85

#### 用户特征
1. **用户ID**：
   - **定义**：通过嵌入层表征为向量，记录用户的兴趣点。
   - **类型**：离散型
   - **例子**：用户ID：54321

2. **用户画像**：
   - **定义**：包括性别、年龄、感兴趣的类目和命名实体等，离散特征经嵌入层表征为向量。
   - **类型**：离散型
   - **例子**：性别："男"，年龄："25岁"，感兴趣的类目："科技"，感兴趣的命名实体："苹果公司"

3. **用户历史行为序列**：
   - **定义**：包括最近搜索过的查询词、点击过的文档、交互过的文档，被表征为多个向量。
   - **类型**：连续型
   - **例子**：最近搜索："买手机"，最近点击文档ID：12345，最近交互文档ID：67890

#### 场景特征
1. **当前时刻**：
   - **定义**：反映用户在不同时间段的搜索需求。
   - **类型**：连续型
   - **例子**：当前时间："2024-07-24 15:30"

2. **是否是周末或节假日**：
   - **定义**：反映用户在不同日期的搜索需求。
   - **类型**：离散型
   - **例子**：是否周末："是"

3. **用户所在地点**：
   - **定义**：用户对所在地内容更感兴趣，因此需要地点特征。
   - **类型**：连续型
   - **例子**：用户地点："北京市海淀区"

4. **设备信息**：
   - **定义**：如iOS和安卓用户的点击率有显著差异。
   - **类型**：离散型
   - **例子**：设备："iPhone"，"安卓"

#### 统计特征
1. **曝光次数**：
   - **定义**：文档的曝光次数。
   - **类型**：连续型
   - **例子**：曝光次数：10000

2. **点击次数**：
   - **定义**：文档的点击次数。
   - **类型**：连续型
   - **例子**：点击次数：5000

